{
  "annotations": {
    "list": []
  },
  "editable": true,
  "graphTooltip": 0,
  "id": null,
  "panels": [
    {
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "options": {
        "mode": "markdown",
        "content": "Use the trace list to find a candidate, then paste the trace ID into the Trace ID filter to load the full trace. Expand spans to see durations and attributes like task.id, message.subject, message.stream, and message.deliver_count."
      },
      "title": "How to Use",
      "type": "text"
    },
    {
      "datasource": {
        "type": "tempo",
        "uid": "tempo"
      },
      "gridPos": {
        "h": 14,
        "w": 24,
        "x": 0,
        "y": 4
      },
      "targets": [
        {
          "query": "{resource.service.name=~\"$service\"} | span[\"message.subject\"] =~ \"$subject\" | span[\"task.id\"] =~ \"$task_id\"",
          "queryType": "traceql",
          "refId": "A",
          "limit": 25
        }
      ],
      "title": "Trace Candidates",
      "type": "traces"
    },
    {
      "datasource": {
        "type": "tempo",
        "uid": "tempo"
      },
      "gridPos": {
        "h": 16,
        "w": 24,
        "x": 0,
        "y": 18
      },
      "targets": [
        {
          "query": "$trace_id",
          "queryType": "traceId",
          "refId": "A"
        }
      ],
      "title": "Trace Detail (Waterfall)",
      "type": "trace"
    }
  ],
  "schemaVersion": 39,
  "templating": {
    "list": [
      {
        "name": "service",
        "type": "custom",
        "label": "Service",
        "current": {
          "selected": true,
          "text": "All",
          "value": ".*"
        },
        "query": "task-manager-server,task-manager-client,task-ingest,task-enricher,task-scheduler,task-worker,task-notifier,task-result-store,task-audit,task-deadletter",
        "options": [],
        "includeAll": true,
        "allValue": ".+"
      },
      {
        "name": "subject",
        "type": "custom",
        "label": "Subject",
        "current": {
          "selected": true,
          "text": "All",
          "value": ".*"
        },
        "query": "tasks.ingest,tasks.schedule,tasks.worker.high,tasks.worker.medium,tasks.worker.low,tasks.results,events.status,events.audit,events.deadletter",
        "options": [],
        "includeAll": true,
        "allValue": ".+"
      },
      {
        "name": "task_id",
        "type": "textbox",
        "label": "Task ID (regex)",
        "current": {
          "selected": true,
          "text": ".+",
          "value": ".+"
        },
        "query": ".+"
      },
      {
        "name": "trace_id",
        "type": "textbox",
        "label": "Trace ID",
        "current": {
          "selected": true,
          "text": "",
          "value": ""
        },
        "query": ""
      }
    ]
  },
  "time": {
    "from": "now-30m",
    "to": "now"
  },
  "title": "Task Manager Trace Detail",
  "uid": "taskmanager-trace-detail",
  "version": 1
}
